<!DOCTYPE html>
<html class="dark" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <meta name="description" content="Explore real-time PM2.5 levels on an interactive 3D globe. 174+ cities with official data. Visualize air quality policies worldwide.">
    <title>Interactive 3D Globe - PM2.5 Visualization | AirLens</title>
    <link rel="canonical" href="https://joymin5655.github.io/Finedust_proj/globe.html">

    <!-- Resource Hints -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="https://api.waqi.info">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>

    <!-- Material Symbols -->
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>

    <!-- Three.js -->
    <script type="importmap">
    {
      "imports": {
        "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
        "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
      }
    }
    </script>

    <!-- TopoJSON for country boundaries -->
    <script src="https://cdn.jsdelivr.net/npm/topojson-client@3/dist/topojson-client.min.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <!-- Main Styles -->
    <link rel="stylesheet" href="css/main.css"/>
    <link rel="stylesheet" href="css/settings.css"/>

    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#25e2f4",
                        "background-light": "#f5f8f8",
                        "background-dark": "#102122",
                    }
                }
            }
        }
    </script>

    <style>
        body { margin: 0; overflow: hidden; }
        
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }

        #globe-container {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: linear-gradient(180deg, #000005 0%, #0a0e1a 100%);
        }

        #globe-canvas {
            display: block;
            width: 100%; height: 100%;
        }

        /* Í∞úÏÑ†Îêú ÏôºÏ™Ω Ìå®ÎÑê - Îçî Ïª¥Ìå©Ìä∏Ìï® */
        #policy-card {
            max-width: 280px !important;
            padding: 12px !important;
            gap: 8px !important;
        }

        #policy-card h3 {
            font-size: 14px !important;
        }

        #policy-card .text-sm {
            font-size: 12px !important;
        }

        /* Ïò§Î•∏Ï™Ω Ïª®Ìä∏Î°§ Ìå®ÎÑê */
        .control-panel {
            max-width: 220px !important;
        }

        /* Ïä§ÌÅ¨Î°§Î∞î Ïä§ÌÉÄÏùº */
        #policy-card::-webkit-scrollbar {
            width: 4px;
        }

        #policy-card::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
        }

        #policy-card::-webkit-scrollbar-thumb {
            background: rgba(37, 226, 244, 0.3);
            border-radius: 2px;
        }

        #policy-card::-webkit-scrollbar-thumb:hover {
            background: rgba(37, 226, 244, 0.5);
        }

        /* Ïï†ÎãàÎ©îÏù¥ÏÖò */
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        #policy-card.show {
            animation: slideIn 0.3s ease-out;
        }

        /* AQI ÏÉâÏÉÅ Ïπ© */
        .aqi-chip {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
            white-space: nowrap;
        }

        .aqi-good { background: #50C878; color: white; }
        .aqi-moderate { background: #FFD700; color: black; }
        .aqi-unhealthy { background: #FF8C00; color: white; }
        .aqi-veryunhealthy { background: #C41E3A; color: white; }
        .aqi-hazardous { background: #8B0000; color: white; }

        /* ÎßàÏª§ Ïä§ÌÉÄÏùº */
        .air-quality-marker {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            z-index: 10;
        }

        .air-quality-marker:hover {
            transform: scale(1.3);
            box-shadow: 0 4px 12px rgba(37, 226, 244, 0.5);
        }

        /* ÌÜ†Í∏Ä Ïä§ÏúÑÏπò */
        .toggle-switch {
            position: relative;
            width: 36px;
            height: 20px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            cursor: pointer;
            border: none;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            padding: 2px;
        }

        .toggle-switch.checked {
            background: #25e2f4;
        }

        .toggle-knob {
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .toggle-switch.checked .toggle-knob {
            transform: translateX(16px);
        }

        @media (max-width: 1024px) {
            #policy-card { max-width: 240px !important; }
            .control-panel { max-width: 200px !important; }
        }

        @media (max-width: 768px) {
            #policy-card, .control-panel {
                max-width: calc(100% - 2rem) !important;
                width: calc(100% - 2rem) !important;
            }
        }
    </style>
</head>

<body class="bg-background-light dark:bg-background-dark">
    <!-- Îã§ÌÅ¨ Î™®Îìú ÌÜ†Í∏Ä -->
    <div class="theme-toggle-container">
        <div class="toggle-cont">
            <input class="toggle-input" id="theme-toggle" type="checkbox" />
            <label class="toggle-label" for="theme-toggle">
                <div class="cont-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 30 30" class="icon">
                        <path d="M0.96233 28.61C1.36043 29.0081 1.96007 29.1255 2.47555 28.8971L10.4256 25.3552C13.2236 24.11 16.4254 24.1425 19.2107 25.4401L27.4152 29.2747C27.476 29.3044 27.5418 29.3023 27.6047 29.32C27.6563 29.3348 27.7079 29.3497 27.761 29.3574C27.843 29.3687 27.9194 29.3758 28 29.3688C28.1273 29.3617 28.2531 29.3405 28.3726 29.2945C28.4447 29.262 28.5162 29.2287 28.5749 29.1842C28.6399 29.1446 28.6993 29.0994 28.7509 29.0477L28.9008 28.8582C28.9468 28.7995 28.9793 28.7274 29.0112 28.656C29.0599 28.5322 29.0811 28.4036 29.0882 28.2734C29.0939 28.1957 29.0868 28.1207 29.0769 28.0415C29.0705 27.9955 29.0585 27.9524 29.0472 27.9072C29.0295 27.8343 29.0302 27.7601 28.9984 27.6901L25.1638 19.4855C23.8592 16.7073 23.8273 13.5048 25.0726 10.7068L28.6145 2.75679C28.8429 2.24131 28.7318 1.63531 28.3337 1.2372C27.9165 0.820011 27.271 0.721743 26.7491 0.9961L19.8357 4.59596C16.8418 6.15442 13.2879 6.18696 10.2615 4.70062L1.80308 0.520214C1.7055 0.474959 1.60722 0.441742 1.50964 0.421943C1.44459 0.409215 1.37882 0.395769 1.3074 0.402133C1.14406 0.395769 0.981436 0.428275 0.818095 0.499692C0.77284 0.519491 0.719805 0.545671 0.67455 0.578198C0.596061 0.617088 0.524653 0.675786 0.4596 0.74084C0.394546 0.805894 0.335843 0.877306 0.296245 0.956502C0.263718 1.00176 0.237561 1.05477 0.217762 1.10003C0.152708 1.24286 0.126545 1.40058 0.120181 1.54978C0.120181 1.61483 0.126527 1.6735 0.132891 1.73219C0.15269 1.85664 0.178881 1.97332 0.237571 2.08434L4.41798 10.5427C5.91139 13.5621 5.8725 17.1238 4.3204 20.1099L0.720514 27.0233C0.440499 27.5536 0.545137 28.1928 0.96233 28.61Z" />
                    </svg>
                </div>
            </label>
        </div>
    </div>

    <!-- ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò Î∞î -->
    <nav class="navbar navbar-transparent">
        <div class="navbar-container">
            <a href="index.html" class="navbar-logo">AirLens</a>
            <button class="navbar-toggle" aria-label="Toggle menu">
                <span></span><span></span><span></span>
            </button>
            <ul class="navbar-menu">
                <li><a href="index.html" class="navbar-link">Home</a></li>
                <li><a href="globe.html" class="navbar-link navbar-link-active">Globe</a></li>
                <li><a href="camera.html" class="navbar-link">Camera AI</a></li>
                <li><a href="research.html" class="navbar-link">Research</a></li>
                <li><a href="about.html" class="navbar-link">About</a></li>
            </ul>
        </div>
    </nav>

    <div class="relative flex h-screen w-full flex-col overflow-hidden">
        <!-- 3D ÏßÄÍµ¨Î≥∏ -->
        <div id="globe-container">
            <canvas id="globe-canvas"></canvas>

            <!-- Î°úÎî© ÌëúÏãú -->
            <div id="loading-indicator" class="absolute inset-0 flex items-center justify-center bg-background-dark/80 backdrop-blur-sm z-50">
                <div class="flex flex-col items-center gap-4">
                    <div class="w-16 h-16 border-4 border-primary/30 border-t-primary rounded-full animate-spin"></div>
                    <p class="text-white text-lg font-medium">Loading Globe...</p>
                </div>
            </div>
        </div>

        <main class="relative z-20 flex flex-1 pointer-events-none">
            <!-- ÏôºÏ™Ω Ï†ïÏ±Ö Ïπ¥Îìú (Ïª¥Ìå©Ìä∏) -->
            <aside id="policy-card" class="pointer-events-auto fixed top-20 bottom-6 left-6 flex flex-col gap-2 rounded-lg bg-gray-900/60 p-3 backdrop-blur-md border border-white/10 overflow-y-auto max-w-[280px] max-h-[calc(100vh-104px)] z-30" style="display: none;">
                
                <!-- Ìó§Îçî -->
                <div class="flex items-start justify-between gap-2">
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center gap-2">
                            <span id="policy-flag" class="text-2xl shrink-0">üåç</span>
                            <div class="min-w-0">
                                <h3 class="text-sm font-bold text-white truncate" id="policy-country">Country</h3>
                                <p class="text-xs text-white/60 truncate" id="policy-region">Region</p>
                            </div>
                        </div>
                    </div>
                    <button onclick="closePolicyCard()" class="text-white/60 hover:text-white shrink-0">
                        <span class="material-symbols-outlined text-base">close</span>
                    </button>
                </div>

                <!-- AQI ÏÉÅÌÉú -->
                <div class="grid grid-cols-2 gap-2">
                    <div class="bg-black/30 rounded p-2 text-center border border-white/10">
                        <p class="text-xs text-white/60 mb-1">AQI</p>
                        <p class="text-lg font-bold text-primary" id="policy-aqi">-</p>
                    </div>
                    <div class="bg-black/30 rounded p-2 text-center border border-white/10">
                        <p class="text-xs text-white/60 mb-1">PM2.5</p>
                        <p class="text-lg font-bold text-primary" id="policy-pm25">-</p>
                    </div>
                </div>

                <!-- Ï∏°Ï†ïÏÜå Ï†ïÎ≥¥ -->
                <div class="bg-black/30 rounded p-2 border border-white/10">
                    <p class="text-xs font-semibold text-white mb-1">üìç Station</p>
                    <p class="text-xs text-white/80" id="policy-station">Loading...</p>
                    <div class="grid grid-cols-2 gap-1 mt-2 text-xs text-white/70">
                        <span>üìè <span id="policy-lat">0¬∞</span></span>
                        <span>üìè <span id="policy-lon">0¬∞</span></span>
                    </div>
                </div>

                <!-- ÏµúÍ∑º ÏóÖÎç∞Ïù¥Ìä∏ -->
                <div class="text-xs text-white/50 text-center border-t border-white/10 pt-2">
                    Updated: <span id="policy-update">-</span>
                </div>
            </aside>

            <!-- Ïò§Î•∏Ï™Ω Ïª®Ìä∏Î°§ Ìå®ÎÑê (Ïª¥Ìå©Ìä∏) -->
            <aside class="pointer-events-auto fixed top-20 bottom-6 right-6 flex flex-col gap-1 rounded-lg bg-gray-900/60 p-2 backdrop-blur-md border border-white/10 overflow-y-auto max-w-[220px] max-h-[calc(100vh-104px)] z-30 control-panel">
                
                <!-- Ìó§Îçî -->
                <h1 class="text-white text-xs font-bold">üåê Globe Controls</h1>

                <!-- ÌÜµÍ≥Ñ -->
                <div class="bg-black/30 rounded p-2 border border-white/10">
                    <p class="text-xs font-bold text-white mb-1">Statistics</p>
                    <div class="grid grid-cols-2 gap-1 text-xs">
                        <div>
                            <p class="text-white/60">Stations</p>
                            <p class="font-bold text-primary" id="stat-stations">-</p>
                        </div>
                        <div>
                            <p class="text-white/60">Countries</p>
                            <p class="font-bold text-primary" id="stat-countries">-</p>
                        </div>
                    </div>
                </div>

                <!-- Î†àÏù¥Ïñ¥ -->
                <div class="border-t border-white/10 pt-1 mt-1">
                    <p class="text-xs font-bold text-white mb-1">Layers</p>
                    
                    <label class="flex items-center gap-2 px-1 py-1 rounded hover:bg-white/5 cursor-pointer">
                        <div class="flex items-center justify-center w-5 h-5 rounded bg-black/30">
                            <span class="material-symbols-outlined text-xs">flag</span>
                        </div>
                        <span class="text-xs text-white">Borders</span>
                        <div class="ml-auto toggle-switch checked" style="width: 32px;">
                            <input type="checkbox" id="toggle-borders" checked>
                            <div class="toggle-knob"></div>
                        </div>
                    </label>

                    <label class="flex items-center gap-2 px-1 py-1 rounded hover:bg-white/5 cursor-pointer">
                        <div class="flex items-center justify-center w-5 h-5 rounded bg-black/30">
                            <span class="material-symbols-outlined text-xs">location_on</span>
                        </div>
                        <span class="text-xs text-white">Markers</span>
                        <div class="ml-auto toggle-switch checked" style="width: 32px;">
                            <input type="checkbox" id="toggle-markers" checked>
                            <div class="toggle-knob"></div>
                        </div>
                    </label>

                    <label class="flex items-center gap-2 px-1 py-1 rounded hover:bg-white/5 cursor-pointer">
                        <div class="flex items-center justify-center w-5 h-5 rounded bg-black/30">
                            <span class="material-symbols-outlined text-xs">air</span>
                        </div>
                        <span class="text-xs text-white">Flow</span>
                        <div class="ml-auto toggle-switch" style="width: 32px;">
                            <input type="checkbox" id="toggle-particles">
                            <div class="toggle-knob"></div>
                        </div>
                    </label>
                </div>

                <!-- Ïª®Ìä∏Î°§ -->
                <div class="border-t border-white/10 pt-1 mt-1">
                    <p class="text-xs font-bold text-white mb-1">Control</p>
                    <div class="flex gap-1">
                        <button id="reset-view" class="flex-1 flex items-center justify-center gap-0.5 rounded h-7 bg-black/30 hover:bg-black/50 text-white text-xs font-semibold">
                            <span class="material-symbols-outlined text-sm">refresh</span>
                        </button>
                        <button id="zoom-in" class="w-7 h-7 flex items-center justify-center rounded bg-black/30 hover:bg-black/50 text-white">
                            <span class="material-symbols-outlined text-sm">add</span>
                        </button>
                        <button id="zoom-out" class="w-7 h-7 flex items-center justify-center rounded bg-black/30 hover:bg-black/50 text-white">
                            <span class="material-symbols-outlined text-sm">remove</span>
                        </button>
                    </div>
                </div>

                <!-- Îç∞Ïù¥ÌÑ∞ ÏÉàÎ°úÍ≥†Ïπ® -->
                <button id="refresh-data" class="w-full flex items-center justify-center gap-1 rounded h-8 bg-primary/20 hover:bg-primary/30 text-primary text-xs font-semibold mt-1">
                    <span class="material-symbols-outlined text-sm" id="refresh-icon">sync</span>
                    <span>Update</span>
                </button>
            </aside>
        </main>

        <!-- ÎèÑÏõÄÎßê -->
        <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 z-30 pointer-events-none">
            <div class="bg-gray-900/90 backdrop-blur-md border border-white/10 rounded px-3 py-2 text-xs text-white/80">
                <span class="material-symbols-outlined text-sm align-middle mr-1">touch_app</span>
                Click markers to see air quality data
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        function closePolicyCard() {
            const card = document.getElementById('policy-card');
            card.style.display = 'none';
        }

        // ÌÜ†Í∏Ä Ïä§ÏúÑÏπò ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
        document.querySelectorAll('.toggle-switch').forEach(toggle => {
            const checkbox = toggle.querySelector('input[type="checkbox"]');
            toggle.addEventListener('click', () => {
                checkbox.checked = !checkbox.checked;
                toggle.classList.toggle('checked');
            });
            checkbox.addEventListener('change', () => {
                toggle.classList.toggle('checked');
            });
        });

        // ÌÜ†Í∏Ä ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî
        document.querySelectorAll('.toggle-switch.checked').forEach(toggle => {
            toggle.querySelector('input[type="checkbox"]').checked = true;
        });
    </script>

    <!-- Ïä§ÌÅ¨Î¶ΩÌä∏ Î°úÎìú -->
    <script src="js/theme-toggle.js"></script>
    <script src="js/main.js"></script>
    <script src="js/config.js"></script>
    <script src="js/air-quality-api.js"></script>
    <script type="module" src="js/globe-improved.js"></script>
</body>
</html>
