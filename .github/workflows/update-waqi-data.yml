name: Update WAQI Data

on:
  schedule:
    - cron: '0 0 * * *'  # ë§¤ì¼ ìì • (UTC)
  workflow_dispatch:  # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥

jobs:
  update-data:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      
      - name: Verify WAQI Token
        run: |
          if [ -z "${{ secrets.WAQI_TOKEN }}" ]; then
            echo "âŒ ERROR: WAQI_TOKEN secret is not configured"
            echo "Please set WAQI_TOKEN in GitHub Settings > Secrets and variables > Actions"
            exit 1
          fi
          echo "âœ… WAQI_TOKEN secret found"
      
      - name: Install dependencies
        run: |
          npm ci
          npm install --no-save axios
      
      - name: Create data directory
        run: mkdir -p app/data/waqi
      
      - name: Fetch WAQI data
        env:
          WAQI_TOKEN: ${{ secrets.WAQI_TOKEN }}
        run: |
          node scripts/fetch-waqi-data.js
        timeout-minutes: 10
      
      - name: Commit and push data
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          
          git add app/data/waqi/
          
          if ! git diff --staged --quiet; then
            git commit -m "ğŸ“Š Update WAQI data - $(date +'%Y-%m-%d %H:%M UTC')"
            git push origin main
            echo "âœ… Changes pushed successfully"
          else
            echo "â„¹ï¸  No changes to commit"
          fi
```

4. í•˜ë‹¨ **"Commit changes..."** ë²„íŠ¼ í´ë¦­
5. ì»¤ë°‹ ë©”ì‹œì§€ ì‘ì„±: `Fix WAQI workflow - add error handling and token verification`
6. **Commit directly to the main branch** ì„ íƒ
7. **Commit changes** í´ë¦­

---

### **Step 3: ì›Œí¬í”Œë¡œìš° ìˆ˜ë™ í…ŒìŠ¤íŠ¸**

1. ì €ì¥ì†Œì˜ **Actions** íƒ­ í´ë¦­
2. ì¢Œì¸¡ "Update WAQI Data" ì›Œí¬í”Œë¡œìš° í´ë¦­
3. **Run workflow** â†’ **Run workflow** (ë“œë¡­ë‹¤ìš´ì—ì„œ main ì„ íƒ)
4. ì‹¤í–‰ ëŒ€ê¸° (1-2ë¶„)

âœ… ì„±ê³µ í‘œì‹œ:
```
âœ… WAQI_TOKEN secret found
âœ… city data fetching completed
âœ… Changes pushed successfully
```

---

## ğŸ“Š ë¬¸ì œ í•´ê²° ì²´í¬ë¦¬ìŠ¤íŠ¸

| í™•ì¸ í•­ëª© | ìƒíƒœ | ì¡°ì¹˜ |
|---------|------|------|
| WAQI_TOKEN ì‹œí¬ë¦¿ ì„¤ì •ë¨? | ? | Settings â†’ Secrets í™•ì¸ |
| ì›Œí¬í”Œë¡œìš° íŒŒì¼ ìˆ˜ì •ë¨? | ? | GitHub UIì—ì„œ ìˆ˜ì • |
| ìˆ˜ë™ í…ŒìŠ¤íŠ¸ ì„±ê³µ? | ? | Actions íƒ­ì—ì„œ ì‹¤í–‰ |
| ë°ì´í„° íŒŒì¼ ìƒì„±ë¨? | ? | `app/data/waqi/latest.json` í™•ì¸ |

---

## ğŸ”§ ì¶”ê°€ íŒ

**ì›Œí¬í”Œë¡œìš° ì¬ì‹¤í–‰í•˜ë ¤ë©´:**
```
Actions â†’ Update WAQI Data â†’ Run workflow â†’ Run workflow
```

**ì˜¤ë¥˜ ë¡œê·¸ ë³´ë ¤ë©´:**
```
Actions â†’ Update WAQI Data â†’ ìµœê·¼ ì‹¤í–‰ í´ë¦­ â†’ update-data í´ë¦­ â†’ ê° ë‹¨ê³„ í™•ì¸
