<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-Content-Type-Options" content="nosniff" />
  <meta http-equiv="X-Frame-Options" content="SAMEORIGIN" />
  <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin" />
  <meta name="description" content="AirLens Policy Research â€” Global air quality policies with PM2.5 trend charts and effectiveness analysis.">
  <title>AirLens - Policy Research</title>

  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: { extend: { colors: { primary: '#25e2f4', 'bg-dark': '#102122' } } }
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/settings.css">

  <style>
    /* â”€â”€ Policy Dashboard Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .policy-dashboard {
      display: grid;
      grid-template-columns: 280px 1fr;
      gap: 0;
      height: calc(100vh - 80px);
      overflow: hidden;
    }
    @media (max-width: 1024px) {
      .policy-dashboard {
        grid-template-columns: 1fr;
        height: auto;
        overflow: auto;
      }
    }

    /* â”€â”€ Left Sidebar: Country List â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .policy-sidebar {
      border-right: 1px solid rgba(255,255,255,.08);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      background: rgba(0,0,0,.15);
    }
    .policy-sidebar-header {
      padding: 16px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      flex-shrink: 0;
    }
    .country-list {
      flex: 1;
      overflow-y: auto;
      padding: 8px;
    }
    .country-list::-webkit-scrollbar { width: 4px; }
    .country-list::-webkit-scrollbar-thumb { background: rgba(255,255,255,.15); border-radius: 4px; }

    .country-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      transition: background .15s;
      border: 1px solid transparent;
    }
    .country-item:hover { background: rgba(37,226,244,.06); }
    .country-item.selected {
      background: rgba(37,226,244,.1);
      border-color: rgba(37,226,244,.3);
    }
    .country-item .flag { font-size: 1.25rem; flex-shrink: 0; }
    .country-item .info { min-width: 0; flex: 1; }
    .country-item .name { font-weight: 600; font-size: .8125rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .country-item .meta { font-size: .6875rem; color: rgba(255,255,255,.4); }
    .country-item .count { font-size: .6875rem; color: #25e2f4; font-weight: 600; }

    /* â”€â”€ Right: Dashboard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .policy-main {
      overflow-y: auto;
      padding: 20px 24px;
      display: flex;
      flex-direction: column;
    }
    .policy-main::-webkit-scrollbar { width: 6px; }
    .policy-main::-webkit-scrollbar-thumb { background: rgba(255,255,255,.1); border-radius: 4px; }

    .dash-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 20px;
    }
    .dash-stats {
      display: flex;
      gap: 24px;
    }
    .dash-stat-value { font-size: 1.75rem; font-weight: 900; color: #25e2f4; line-height: 1; }
    .dash-stat-label { font-size: .6875rem; color: rgba(255,255,255,.4); margin-top: 2px; }

    /* Dashboard grid */
    .dash-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-template-rows: auto 1fr;
      gap: 16px;
      flex: 1;
      min-height: 0;
    }
    @media (max-width: 1280px) {
      .dash-grid { grid-template-columns: 1fr; }
    }

    .dash-card {
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.2);
      padding: 16px;
      display: flex;
      flex-direction: column;
    }
    .dash-card-title {
      font-size: .6875rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: .08em;
      color: rgba(255,255,255,.4);
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .dash-card-title .material-symbols-outlined { font-size: 14px; color: #25e2f4; }

    /* Effect card highlight */
    .dash-card.effect {
      border-color: rgba(37,226,244,.2);
      background: rgba(37,226,244,.03);
    }

    /* Credibility bar */
    .cred-bar { transition: width .6s ease; }

    /* Placeholder state */
    .dash-placeholder {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 8px;
      color: rgba(255,255,255,.25);
      text-align: center;
      grid-column: 1 / -1;
      padding: 60px 0;
    }
    .dash-placeholder .material-symbols-outlined { font-size: 48px; }
    .dash-placeholder p { font-size: .875rem; }
  </style>
</head>
<body class="bg-gray-50 dark:bg-bg-dark min-h-screen flex flex-col">
  <script>if(localStorage.getItem('theme')==='dark')document.documentElement.classList.add('dark');</script>

  <!-- â”€â”€ Dark Mode Toggle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="theme-toggle-container">
    <div class="toggle-cont">
      <input class="toggle-input" id="theme-toggle" name="toggle" type="checkbox" />
      <label class="toggle-label" for="theme-toggle">
        <div class="cont-icon">
          <span style="--sparkle-width:2;--sparkle-deg:25;--sparkle-duration:11"  class="sparkle"></span>
          <span style="--sparkle-width:1;--sparkle-deg:100;--sparkle-duration:18" class="sparkle"></span>
          <span style="--sparkle-width:2;--sparkle-deg:200;--sparkle-duration:3"  class="sparkle"></span>
          <span style="--sparkle-width:2;--sparkle-deg:300;--sparkle-duration:9"  class="sparkle"></span>
          <span style="--sparkle-width:1;--sparkle-deg:250;--sparkle-duration:4"  class="sparkle"></span>
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 30 30" class="icon">
            <path d="M0.96233 28.61C1.36043 29.0081 1.96007 29.1255 2.47555 28.8971L10.4256 25.3552C13.2236 24.11 16.4254 24.1425 19.2107 25.4401L27.4152 29.2747C27.476 29.3044 27.5418 29.3023 27.6047 29.32C27.6563 29.3348 27.7079 29.3497 27.761 29.3574C27.843 29.3687 27.9194 29.3758 28 29.3688C28.1273 29.3617 28.2531 29.3405 28.3726 29.2945C28.4447 29.262 28.5162 29.2287 28.5749 29.1842C28.6399 29.1446 28.6993 29.0994 28.7509 29.0477L28.9008 28.8582C28.9468 28.7995 28.9793 28.7274 29.0112 28.656C29.0599 28.5322 29.0811 28.4036 29.0882 28.2734C29.0939 28.1957 29.0868 28.1207 29.0769 28.0415C29.0705 27.9955 29.0585 27.9524 29.0472 27.9072C29.0295 27.8343 29.0302 27.7601 28.9984 27.6901L25.1638 19.4855C23.8592 16.7073 23.8273 13.5048 25.0726 10.7068L28.6145 2.75679C28.8429 2.24131 28.7318 1.63531 28.3337 1.2372C27.9165 0.820011 27.271 0.721743 26.7491 0.9961L19.8357 4.59596C16.8418 6.15442 13.2879 6.18696 10.2615 4.70062L1.80308 0.520214C1.7055 0.474959 1.60722 0.441742 1.50964 0.421943C1.44459 0.409215 1.37882 0.395769 1.3074 0.402133C1.14406 0.395769 0.981436 0.428275 0.818095 0.499692C0.77284 0.519491 0.719805 0.545671 0.67455 0.578198C0.596061 0.617088 0.524653 0.675786 0.4596 0.74084C0.394546 0.805894 0.335843 0.877306 0.296245 0.956502C0.263718 1.00176 0.237561 1.05477 0.217762 1.10003C0.152708 1.24286 0.126545 1.40058 0.120181 1.54978C0.120181 1.61483 0.126527 1.6735 0.132891 1.73219C0.15269 1.85664 0.178881 1.97332 0.237571 2.08434L4.41798 10.5427C5.91139 13.5621 5.8725 17.1238 4.3204 20.1099L0.720514 27.0233C0.440499 27.5536 0.545137 28.1928 0.96233 28.61Z"/>
          </svg>
        </div>
      </label>
    </div>
  </div>

  <!-- â”€â”€ Navigation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <nav class="navbar">
    <div class="navbar-container">
      <a href="index.html" class="navbar-logo">AirLens</a>
      <button class="navbar-toggle" aria-label="Toggle menu">
        <span></span><span></span><span></span>
      </button>
      <ul class="navbar-menu">
        <li><a href="index.html"  class="navbar-link" data-i18n="nav.today">Today</a></li>
        <li><a href="globe.html"  class="navbar-link" data-i18n="nav.globe">Globe</a></li>
        <li><a href="camera.html" class="navbar-link" data-i18n="nav.camera">Camera AI</a></li>
        <li><a href="policy.html" class="navbar-link navbar-link-active" data-i18n="nav.policy">Policy</a></li>
        <li><a href="about.html"  class="navbar-link" data-i18n="nav.about">About</a></li>
        <li><a href="settings.html" class="navbar-link">
          <div class="settings-icon"><div class="loader-icon"></div></div>
        </a></li>
      </ul>
    </div>
  </nav>

  <!-- â”€â”€ Policy Dashboard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="policy-dashboard" style="margin-top: 64px;">

    <!-- â”€â”€ Left Sidebar: Country List â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <aside class="policy-sidebar">
      <div class="policy-sidebar-header">
        <input id="policy-search" type="text" placeholder="Search countryâ€¦"
               data-i18n-placeholder="policy.search.placeholder"
               class="w-full rounded-lg border border-white/10
                      bg-white/5 text-gray-200 text-xs px-3 py-2
                      focus:outline-none focus:border-primary placeholder:text-gray-500" />
        <select id="policy-region"
                class="w-full mt-2 rounded-lg border border-white/10
                       bg-white/5 text-gray-200 text-xs px-3 py-1.5
                       focus:outline-none focus:border-primary">
          <option value="">All Regions</option>
          <option value="East Asia">East Asia</option>
          <option value="South Asia">South Asia</option>
          <option value="Southeast Asia">Southeast Asia</option>
          <option value="Europe">Europe</option>
          <option value="North America">North America</option>
          <option value="South America">South America</option>
          <option value="Middle East">Middle East</option>
          <option value="Africa">Africa</option>
          <option value="Oceania">Oceania</option>
        </select>
      </div>
      <div id="policy-list" class="country-list">
        <div class="text-center py-12 text-gray-500 text-xs">
          <span class="material-symbols-outlined text-2xl block mb-2">hourglass_empty</span>
          Loadingâ€¦
        </div>
      </div>
    </aside>

    <!-- â”€â”€ Right: Dashboard Area â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <section class="policy-main" id="detail-panel">

      <!-- Dashboard Header (always visible) -->
      <div class="dash-header">
        <div>
          <h1 class="text-xl font-black text-white tracking-tight"
              data-i18n="policy.title">ğŸŒ¿ Policy Research</h1>
          <p class="text-gray-500 text-xs mt-1"
             data-i18n="policy.subtitle">How do government policies actually affect PM2.5?</p>
        </div>
        <div class="dash-stats">
          <div class="text-center">
            <p class="dash-stat-value" id="stat-countries">--</p>
            <p class="dash-stat-label" data-i18n="policy.stat.countries">Countries</p>
          </div>
          <div class="text-center">
            <p class="dash-stat-value" id="stat-policies">--</p>
            <p class="dash-stat-label" data-i18n="policy.stat.policies">Policies</p>
          </div>
          <div class="text-center">
            <p class="dash-stat-value text-base mt-1">ğŸ“Š</p>
            <p class="dash-stat-label" data-i18n="policy.stat.source">OWID Â· IHME</p>
          </div>
        </div>
      </div>

      <!-- Placeholder (before selection) -->
      <div id="detail-placeholder" class="dash-placeholder">
        <span class="material-symbols-outlined">touch_app</span>
        <p data-i18n="policy.detail.hint">Select a country from the list to view policy analysis</p>
      </div>

      <!-- Dashboard Content (shown on selection) -->
      <div id="detail-content" style="display:none;" class="flex flex-col flex-1 min-h-0">

        <!-- Country Title Bar -->
        <div class="flex items-center gap-3 mb-4">
          <span id="detail-flag" class="text-3xl">ğŸŒ</span>
          <div class="flex-1">
            <h2 id="detail-country" class="text-white font-bold text-lg leading-tight"></h2>
            <p id="detail-region" class="text-gray-500 text-xs"></p>
          </div>
          <a id="detail-link" href="#" target="_blank" rel="noopener"
             class="flex items-center gap-1.5 rounded-lg bg-primary/10 border border-primary/20
                    text-primary font-semibold px-3 py-1.5 text-xs hover:bg-primary/20 transition-colors">
            <span class="material-symbols-outlined text-sm">open_in_new</span>
            Source
          </a>
        </div>

        <!-- Dashboard Grid -->
        <div class="dash-grid flex-1 min-h-0">

          <!-- Card 1: Policy Info -->
          <div class="dash-card">
            <div class="dash-card-title">
              <span class="material-symbols-outlined">description</span>
              Policy Details
            </div>
            <h3 id="detail-title" class="text-primary font-bold text-sm mb-1"></h3>
            <p id="detail-authority" class="text-gray-500 text-xs mb-2"></p>
            <p id="detail-desc" class="text-gray-300 text-xs leading-relaxed flex-1 overflow-y-auto"></p>
            <!-- Credibility -->
            <div class="mt-3 pt-3 border-t border-white/5">
              <div class="flex justify-between text-xs text-gray-500 mb-1">
                <span data-i18n="policy.detail.credibility">Data Credibility</span>
                <span id="detail-cred-pct">--%</span>
              </div>
              <div class="h-1.5 w-full bg-gray-700 rounded-full overflow-hidden">
                <div id="detail-cred-bar" class="cred-bar h-1.5 bg-primary rounded-full" style="width:0%"></div>
              </div>
            </div>
            <!-- Target -->
            <div class="mt-3 rounded-lg bg-white/5 p-3 text-center">
              <p id="detail-target-label" class="text-xs text-gray-500 mb-0.5" data-i18n="policy.detail.target">PM2.5 Target</p>
              <p class="text-xl font-black text-primary"><span id="detail-target">--</span> <span class="text-sm font-normal text-gray-400">Âµg/mÂ³</span></p>
              <p class="text-xs text-gray-500">by <span id="detail-year">----</span></p>
            </div>
          </div>

          <!-- Card 2: Policy Effect Analysis -->
          <div id="detail-effect-wrap" class="dash-card effect" style="display:none;">
            <div class="dash-card-title">
              <span class="material-symbols-outlined">bar_chart</span>
              Policy Effect Analysis
            </div>
            <!-- Before / After -->
            <div class="grid grid-cols-2 gap-3 mb-3">
              <div class="rounded-lg bg-white/5 p-3 text-center">
                <p class="text-xs text-gray-500 mb-1">Before</p>
                <p id="eff-before" class="text-lg font-black text-gray-200">--</p>
              </div>
              <div class="rounded-lg bg-white/5 p-3 text-center">
                <p class="text-xs text-gray-500 mb-1">After</p>
                <p id="eff-after" class="text-lg font-black text-gray-200">--</p>
              </div>
            </div>
            <!-- Change chip + significance -->
            <div class="flex items-center justify-between mb-3">
              <span id="eff-pct" class="text-sm font-black rounded-full px-3 py-1 bg-emerald-900/40 text-emerald-400">--</span>
              <span id="eff-sig" class="text-xs text-gray-400"></span>
            </div>
            <!-- Region comparison -->
            <p id="eff-group" style="display:none;"
               class="text-xs text-gray-400 leading-relaxed p-2 rounded-lg bg-white/5 mb-3"></p>
            <!-- Timeline mini chart -->
            <div id="eff-timeline" style="display:none;" class="flex-1 min-h-0">
              <p class="text-xs text-gray-500 mb-1">
                ğŸ“Œ <span class="text-red-400 font-semibold">Red dot</span> = policy enacted
              </p>
              <canvas id="eff-timeline-chart" class="w-full" style="max-height:160px;"></canvas>
            </div>
          </div>

          <!-- Card 2 fallback: shown when no effect data -->
          <div id="detail-effect-placeholder" class="dash-card effect">
            <div class="dash-card-title">
              <span class="material-symbols-outlined">bar_chart</span>
              Policy Effect Analysis
            </div>
            <div class="flex-1 flex items-center justify-center text-gray-600 text-xs">
              Select a country to view effect analysis
            </div>
          </div>

          <!-- Card 3: PM2.5 Trend Chart (spans full width) -->
          <div id="detail-chart-wrap" class="dash-card" style="display:none; grid-column: 1 / -1;">
            <div class="dash-card-title">
              <span class="material-symbols-outlined">show_chart</span>
              PM2.5 Trend
            </div>
            <div class="flex-1 min-h-0" style="min-height: 180px;">
              <canvas id="detail-chart" class="w-full h-full"></canvas>
            </div>
          </div>

          <!-- Card 4: Enhanced Data (AOD + OpenAQ) â€” spans full width -->
          <div id="detail-enhanced-wrap" class="dash-card" style="display:none; grid-column: 1 / -1;">
            <div class="dash-card-title">
              <span class="material-symbols-outlined">satellite_alt</span>
              Additional Data Sources
            </div>
            <div id="enhanced-data-content" class="flex flex-col gap-3"></div>
          </div>

        </div><!-- /dash-grid -->
      </div><!-- /detail-content -->

    </section><!-- /policy-main -->

  </div><!-- /policy-dashboard -->

  <script src="js/utils/config.js"></script>
  <script src="js/i18n.js"></script>
  <script src="js/theme-toggle.js"></script>
  <script src="js/main.js"></script>
  <script src="js/services/dataService.js"></script>
  <script src="js/services/pmService.js"></script>
  <script src="js/services/uiService.js"></script>
  <script src="js/policy.js"></script>
</body>
</html>
